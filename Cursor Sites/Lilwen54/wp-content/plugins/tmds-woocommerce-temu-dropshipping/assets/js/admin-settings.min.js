function tmds_ajax(e){"use strict";window.fetch(e.url,{method:e.type,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:e.data}).then(e=>e.ok?e.json():e.text().then(t=>{throw{statusText:e.statusText,responseText:t}})).then(e.success).catch(t=>e.error&&e.error(t)).finally(()=>e.complete&&e.complete())}jQuery(document).ready(function(e){"use strict";if("undefined"==typeof tmds_params)return;if(tmds_params.go_to_tmds_bt&&e(".woocommerce-BlankState-buttons").length)return void e(".woocommerce-BlankState-buttons").append(tmds_params.go_to_tmds_bt);if(!tmds_params.nonce)return;let t=tmds_params.nonce,s=tmds_params.ajax_url;function a(){e(".tmds-search-select2:not(.tmds-search-select2-init)").each(function(){let t=e(this),a=!t.prop("multiple"),d="select",n={};switch(t.data("type_select2")){case"category":d="Please enter category name to search",n={action:"woocommerce_json_search_categories",show_empty:!0,security:wc_enhanced_select_params.search_categories_nonce};break;case"tag":d="Please enter tag to search",n={action:"woocommerce_json_search_taxonomy_terms",security:wc_enhanced_select_params.search_taxonomy_terms_nonce,limit:50,taxonomy:"product_tag"};break;case"product":d="Please enter product title to search",n={action:"woocommerce_json_search_products_and_variations",security:wc_enhanced_select_params.search_products_nonce};break;default:n={not_ajax:1,data:[],select:t},t.find("option").each(function(t,s){let a=!0;n.data.push({id:e(s).val(),text:e(s).text()}),e(s).prop("selected")&&(a=!1),a&&e(s).remove()})}t.addClass("tmds-search-select2-init").select2(function(t,a,d,n){let l={width:"100%",closeOnSelect:d,placeholder:t,cache:!0};if(Object.keys(a).length)if(l.minimumInputLength=n,l.escapeMarkup=function(e){return e},a?.not_ajax){let t,s=a.data,d=e(a.select),l={};d.on("select2:open",function(){let a=e(".select2-search__field"),o=d.val();a.off("input blur").on("input blur",function(){let a=e(this).val().trim().toLowerCase(),r=[];a.length<n||t===a||(t=a,l[a]?r=l[a]:(r=s.filter(e=>e.text.toLowerCase().includes(a)),l[a]=r),d.find('option:not([value="'+o+'"])').remove(),r.forEach(e=>{o!=e.id&&d.append(new Option(e.text,e.id,!1,!1))}),d.trigger("change.select2"))})})}else l.ajax={url:s,dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(t){return e.extend(a,{term:t.term})},processResults:function(t){console.log(t);let s=[];return t&&e.each(t,function(e,t){s.push({id:t?.term_id||e,text:t?.formatted_name||t?.name||t})}),console.log(s),{results:s}},cache:!0};return l}(d,n,a,2))})}e(".vi-ui.tabular.menu").length&&e(".vi-ui.tabular.menu .item").tab({history:!0,historyType:"hash"}),e(".vi-ui.accordion").length&&e(".vi-ui.accordion:not(.tmds-accordion-init)").addClass("tmds-accordion-init").accordion("refresh"),e(".vi-ui.checkbox:not(.tmds-checkbox-init)").addClass("tmds-checkbox-init").off().checkbox(),e(".vi-ui.dropdown:not(.tmds-dropdown-init)").addClass("tmds-dropdown-init").off().dropdown({fullTextSearch:!0}),e(document).on("click",".tmds-save-settings",function(t){let s=e("#tmds-import_currency_rate");if(s.length&&!s.val())return e(document.body).trigger("villatheme_show_message",["Please enter Import products currency exchange rate",["error"],"",!1,4500]),s.trigger("focus"),t.preventDefault(),t.stopPropagation(),!1;e(this).addClass("loading")}),e(document).on("change","input[type=checkbox]",function(){let t=e(this).prop("checked")?1:0,s=e(this).parent().find("input[type=hidden]");s.val(t),e(this).prop("checked")?(e(".tmds-"+s.attr("name")+"-disable-class").addClass("tmds-hidden"),e(".tmds-"+s.attr("name")+"-enable-class").removeClass("tmds-hidden")):(e(".tmds-"+s.attr("name")+"-disable-class").removeClass("tmds-hidden"),e(".tmds-"+s.attr("name")+"-enable-class").addClass("tmds-hidden"))}),e(document).on("change",".tmds-toggle-field select",function(){let t=parseFloat(e(this).val()),s=e(this).attr("id")||e(this).attr("name"),a=e(".tmds-"+s+"-enable-class"),d=e(".tmds-"+s+"-disable-class");t?(a.removeClass("tmds-hidden"),d.addClass("tmds-hidden")):(a.addClass("tmds-hidden"),d.removeClass("tmds-hidden"))}),e(document).on("tmds_render_fulfill_map_html",function(t,s){let a=e("#tmds-fulfill_map_countries").closest("table");s.length?(e.each(s,function(e,t){a.after(tmds_params.fulfill_map_html[t])}),e(".tmds-fulfill_map_fields-wrap").find(".vi-ui.dropdown").addClass("tmds-dropdown-init").off().dropdown({fullTextSearch:!0}),e(".tmds-fulfill_map_fields-wrap").addClass("tmds-accordion-init").off().accordion("refresh"),a.find(".tmds-fulfill_map_fields-wrap").remove()):a.find(".tmds-fulfill_map_fields-wrap").remove()}),e(document).on("change","#tmds-fulfill_map_countries",function(){let a=e(this).val(),d=e(this).closest("table");if(tmds_params.fulfill_map_html||(tmds_params.fulfill_map_html={}),e(".tmds-fulfill_map_fields-wrap").length&&e(".tmds-fulfill_map_fields-wrap").each(function(t,s){let a=e(s).data("country");if(!a||tmds_params.fulfill_map_html[a])return!0;tmds_params.fulfill_map_html[a]=e(s).clone()}),e(".tmds-fulfill_map_fields-wrap").remove(),tmds_params?.fulfill_map_xhr&&tmds_params.fulfill_map_xhr.abort(),!a.length)return;d.append('<tr class="tmds-warehouse_enable-enable-class tmds-fulfill_map_fields-wrap"><td colspan="2"><span class="vi-ui button loading"></span></td></tr>');let n=[];e.each(a,function(e,t){tmds_params.fulfill_map_html[t]||n.push(t)}),n.length?tmds_params.fulfill_map_xhr=e.ajax({url:s,type:"POST",data:{action:"tmds_get_fulfill_map_html",tmds_nonce:t,countries:n},success:function(t){if(t?.html){e("<div>"+t.html+"</div>").find(".tmds-fulfill_map_fields-wrap").each(function(t,s){let a=e(s).data("country");a&&(tmds_params.fulfill_map_html[a]=e(s).clone())}),e(document).trigger("tmds_render_fulfill_map_html",[a])}t?.message&&e.each(t.message,function(s,a){e(document.body).trigger("villatheme_show_message",[a,[t.status],"",!1,4500])})},error:function(t){0!=t?.status&&(console.log(t),e(document.body).trigger("villatheme_show_message",[t.statusText,["error"],"-1"===t.responseText?"":t.responseText,!1,4500]))}}):e(document).trigger("tmds_render_fulfill_map_html",[a])}),e(document).on("change","#tmds-warehouse_enable",function(){let t=e(this).val(),s=e(".tmds-"+e(this).attr("name")+"-enable-class"),a=e(".tmds-"+e(this).attr("name")+"-disable-class");if("0"!==t){s.removeClass("tmds-hidden");for(let e=0;e<s.length;e++)s.eq(e).is(".tmds-toggle-field")&&s.eq(e).find("select").trigger("change")}else s.addClass("tmds-hidden");"1"!==t?a.removeClass("tmds-hidden"):a.addClass("tmds-hidden")}),e(document).on("change",".warehouse_fields_country select",function(d){let n=e(this).data("old_val"),l=e(this).val();if(tmds_params.warehouse_fields_html||(tmds_params.warehouse_fields_html={}),tmds_params.warehouse_fields_html[n]||(tmds_params.warehouse_fields_html[n]=e(".tmds-warehouse_enable-enable-class.tmds-warehouse_fields-class").clone()),l!=n){if(tmds_params?.warehouse_address_xhr&&tmds_params.warehouse_address_xhr.abort(),e(this).data("old_val",l),e(".tmds-warehouse_fields-class").remove(),tmds_params?.warehouse_fields_html[l])return e(".tmds-warehouse_enable-enable-class").after(tmds_params.warehouse_fields_html[l]),e(".tmds-warehouse_fields-class").find(".vi-ui.dropdown").addClass("tmds-dropdown-init").off().dropdown({fullTextSearch:!0}),void a();e(".tmds-warehouse_enable-enable-class").after('<tr class="tmds-warehouse_enable-enable-class tmds-warehouse_fields-class"><td colspan="2"><span class="vi-ui button loading"></span></td></tr>'),tmds_params.warehouse_address_xhr=e.ajax({url:s,type:"POST",data:e.param({action:"tmds_get_warehouse_fields",tmds_nonce:t,country:l}),success:function(t){t?.html&&(tmds_params.warehouse_fields_html[l]=t.html,e(".tmds-warehouse_fields-class").remove(),e(".tmds-warehouse_enable-enable-class").after(t.html),e(".tmds-warehouse_fields-class").find(".vi-ui.dropdown").addClass("tmds-dropdown-init").off().dropdown({fullTextSearch:!0}),a()),t?.message&&e.each(t.message,function(s,a){e(document.body).trigger("villatheme_show_message",[a,[t.status],"",!1,4500])})},error:function(t){0!=t?.status&&(console.log(t),e(document.body).trigger("villatheme_show_message",[t.statusText,["error"],"-1"===t.responseText?"":t.responseText,!1,4500]))}})}}),e(document).on("tmds_render_warehouse_address_html",function(t,s,a){switch(s?.type){case"html":a.html(s?.data);let e="";2===a.find("option").length&&(e=a.find("option").eq(1).val()),a.dropdown("refresh"),a.dropdown("clear"),setTimeout(function(e,t){e.dropdown("set selected",t)},550,a,e);break;case"val":a.val(s?.data);break;case"select":a.after(s?.data)}e(".warehouse_fields_detect-loading").remove(),s?.show&&a.closest(".warehouse_fields_detect").removeClass("tmds-hidden"),a.closest("td").find(".tmds-not-click").removeClass("tmds-not-click")}),e(document).on("change",".tmds-warehouse-field-detect select",function(a){let d=e(".warehouse_fields_country select").val(),n=e(this).val(),l=e(this).data("type"),o=e('.warehouse_fields_detect [data-detect="'+l+'"]');if(l&&o.length)tmds_params?.warehouse_address_xhr&&tmds_params.warehouse_address_xhr.abort(),tmds_params.warehouse_address||(tmds_params.warehouse_address={}),tmds_params.warehouse_address[d]||(tmds_params.warehouse_address[d]={}),o.closest(".warehouse_fields_detect").addClass("tmds-hidden"),e(".warehouse_fields_detect-loading").length||o.closest(".tmds-warehouse_enable-enable-class").find("td").append('<span class="warehouse_fields_detect-loading vi-ui button loading"></span>'),tmds_params.warehouse_address[d][n]?e(document).trigger("tmds_render_warehouse_address_html",[tmds_params.warehouse_address[d][n],o]):tmds_params.warehouse_address_xhr=e.ajax({url:s,type:"POST",data:e.param({action:"tmds_get_warehouse_address",tmds_nonce:t,country:d,region_id:n,is_postcode:"post_code"===o.data("type")?1:"",is_postcode_options:o.is("select")?1:""}),success:function(t){t?.data&&(tmds_params.warehouse_address[d][n]=t.data,e(document).trigger("tmds_render_warehouse_address_html",[t.data,o])),t?.message&&e.each(t.message,function(s,a){e(document.body).trigger("villatheme_show_message",[a,[t.status],"",!1,4500])})},error:function(t){0!=t?.status&&(console.log(t),e(document.body).trigger("villatheme_show_message",[t.statusText,["error"],"-1"===t.responseText?"":t.responseText,!1,4500]))}});else if("region3"===l&&e("#warehouse_fields_post_code").length&&!["DE"].includes(d)){let t=e(this).find('option[value="'+n+'"]').text(),s=/\((.*?)\)/gm.exec(t);s&&s[1]&&e("#warehouse_fields_post_code").val(s[1])}}),e(document).on("change",".tmds-price-exchange-rate-decimals",function(){let t=e(this).val(),s=e(this).closest("tr").find(".tmds-price-exchange-rate");s.val(new Intl.NumberFormat("en-US",{maximumFractionDigits:t}).format(s.val()))}),e(document).on("tmds_currency_update_rate",function(a,d,n,l){if(!n.length||["0",""].includes(l))return void d.removeClass("loading");let o=d.data("tooltip");d.removeAttr("data-tooltip"),d.addClass("loading"),tmds_ajax({url:s,type:"POST",data:e.param({action:"tmds_currency_update_rate",tmds_nonce:t,curcy:n,api:l}),success:function(t){t?.rates&&e.each(t.rates,function(t,s){e(`input[name="import_currency_rate[${t}]"]`).val(s)}),t?.decimals&&e.each(t.decimals,function(t,s){e(`input[name="exchange_rate_decimals[${t}]"]`).val(s)}),t?.message&&e.each(t.message,function(s,a){e(document.body).trigger("villatheme_show_message",[a,[t.status],"",!1,4500])})},error:function(t){console.log(t),e(document.body).trigger("villatheme_show_message",[t.statusText,["error"],"-1"===t.responseText?"":t.responseText,!1,4500])},complete:function(){d.removeClass("loading"),o&&d.attr({"data-tooltip":o})}})}),e(document).on("click",".tmds-price-rule-update",function(){let t=e("select#tmds-exchange_rate_api").val(),s=e(this);if("0"===t)return;if(e(".tmds-price-rule-update.loading").length||e(".tmds-price-rule-update-all.loading").length)return;let a=s.closest(".tmds-price-rule-row");e(document).trigger("tmds_currency_update_rate",[s,[{currency:a.find("#tmds-import_currency_rate").val(),decimal:a.find(".tmds-price-exchange-rate-decimals").val()}],e("select#tmds-exchange_rate_api").val()])}),e(document).on("click",".tmds-price-rule-update-all",function(){let t=e("select#tmds-exchange_rate_api").val(),s=e(this),a=[];"0"!==t&&(e(".tmds-price-rule-update.loading").length||(jQuery(".tmds-price-exchange-rates-container").find(".tmds-price-rule-row").each(function(t,s){let d=e(s);a.push({currency:d.find("#tmds-import_currency_rate").val(),decimal:d.find(".tmds-price-exchange-rate-decimals").val()})}),e(document).trigger("tmds_currency_update_rate",[s,a,e("select#tmds-exchange_rate_api").val()])))}),e(document).on("change","select#tmds-exchange_rate_api",function(){"0"===e(this).val()?(e(".tmds-exchange-rate-info").closest(".buttons").addClass("tmds-exchange-rate-info-hidden"),e(".tmds-exchange-rate-info").addClass("tmds-hidden")):(e(".tmds-exchange-rate-info").removeClass("tmds-hidden"),e(".tmds-exchange-rate-info").closest(".buttons").removeClass("tmds-exchange-rate-info-hidden"))}),e(document).on("change","select#tmds-import_currency_rate",function(){let t=e(this).val();e(this).closest("tr").find("input.tmds-input-reset").each(function(s,a){e(a).attr("name",e(a).data("name").replace("{currency_code}",t))})}),e(document).on("change",'select[name="plus_value_type[]"], select[name="price_default[plus_value_type]"]',function(){let t=e(this).closest("tr");switch(e(this).val()){case"fixed":t.find(".tmds-value-label-left").html("+"),t.find(".tmds-value-label-right").html(t.closest(".price-rule").data("currency_symbol"));break;case"percent":t.find(".tmds-value-label-left").html("+"),t.find(".tmds-value-label-right").html("%");break;case"multiply":t.find(".tmds-value-label-left").html("x"),t.find(".tmds-value-label-right").html("");break;default:t.find(".tmds-value-label-left").html("="),t.find(".tmds-value-label-right").html(t.closest(".price-rule").data("currency_symbol"))}}),e(document).on("click",".tmds-price-rule-add",function(){let t=e(this).closest(".accordion"),s=t.find(".tmds-price-rule-row").last().clone();s.find(".tmds-input-reset").val(""),s.find(".tmds-price-to").val(""),s.find(".vi-ui.dropdown").off().dropdown(),t.find(".tmds-price-rule-container").append(s)}),e(document).on("click",".tmds-price-rule-remove",function(){let t=e(this).closest(".accordion").find(".tmds-price-rule-row"),s=e(this).closest(".tmds-price-rule-row");t.length>1&&confirm("Do you want to remove this row?")&&(s.fadeOut(300),setTimeout(()=>s.remove(),300))}),a(),e(document).on("change",".tmds-select-plugin",function(){let t=e(".tmds-select-plugin:checked").length;e(".tmds-finish span").text(t>0?"Install & Return to Dashboard":"Return to Dashboard"),t||e(".tmds-toggle-select-plugin").prop("checked",!1)}),e(document).on("change",".tmds-toggle-select-plugin",function(){let t=e(this).prop("checked");e(".tmds-select-plugin").prop("checked",t),e(".tmds-finish span").text(t?"Install & Return to Dashboard":"Return to Dashboard")}),e(document).on("click",".tmds-finish",function(){let a=e(this),d=e(".tmds-select-plugin:checked").map((t,s)=>e(s).data("plugin_slug")).toArray();if(d.length){a.addClass("loading");let n=!1;tmds_ajax({url:s,type:"POST",data:e.param({action:"tmds_setup_install_plugins",tmds_nonce:t,install_plugins:d}),success:function(t){"success"===t.status&&t?.installed_plugins&&(n=t.installed_plugins),t?.message&&e.each(t?.message,function(e,s){jQuery(document.body).trigger("villatheme_show_message",[s,[t.status],"",!1,4500])})},error:function(e){console.log(e),n=!1,jQuery(document.body).trigger("villatheme_show_message",[e.statusText,["error"],"-1"===e.responseText?"":e.responseText,!1,4500])},complete:function(){if(!n)return a.removeClass("loading"),!1;tmds_ajax({url:s,type:"POST",data:e.param({action:"tmds_setup_activate_plugins",tmds_nonce:t,install_plugins:n}),error:function(e){console.log(e),a.removeClass("loading"),jQuery(document.body).trigger("villatheme_show_message",[e.statusText,["error"],"-1"===e.responseText?"":e.responseText,!1,4500])},success:function(e){!e.success&&e.data&&jQuery(document.body).trigger("villatheme_show_message",[e.data,["error"],"",!1,4500])},complete:function(e){a.removeClass("loading"),window.location.href=tmds_params.settings_page_url}})}})}else window.location.href=tmds_params.settings_page_url;return!1}),jQuery(".villatheme-get-key-button").one("click",function(e){let t=jQuery(this);t.addClass("loading");let s,a=t.data(),d=a.id,n=a.href,l=window.location.hostname;l=l.toLowerCase(),e.preventDefault();t.attr("data-download");s=window.open(n,"myWindow","width=380,height=600"),window.addEventListener("message",function(e){let s=jQuery.parseJSON(e.data),a="",n=s.message,o="",r="";if(s.data.length>0){for(let e=0;e<s.data.length;e++)if(s.data[e].id==d&&(s.data[e].domain==l||""==s.data[e].domain||null==s.data[e].domain)&&((""==a||o<s.data[e].support_until)&&(a=s.data[e].download_key,o=s.data[e].support_until),s.data[e].domain==l)){a=s.data[e].download_key;break}a&&(r=1,jQuery(".villatheme-autoupdate-key-field").val(a))}t.removeClass("loading"),r?(jQuery("<p><strong>"+n+"</strong></p>").insertAfter(".villatheme-autoupdate-key-field"),jQuery(t).closest("form").submit()):jQuery("<p><strong> Your key is not found. Please contact support@villatheme.com </strong></p>").insertAfter(".villatheme-autoupdate-key-field")})})});