jQuery(document).ready(function(t){"use strict";let e,s,i=[],a=!1,d=!1,o=!1;function r(){t(".tmds-override-product-options-container").addClass("tmds-hidden"),e=[],s=0,f()}t(".vi-ui.tabular.menu .item").tab(),t(".vi-ui.accordion").accordion("refresh"),t(".ui-sortable").sortable(),t(".vi-ui.dropdown:not(.tmds-accordion-bulk-actions)").dropdown(),t(document).on("change","input[type=number]",function(e){if(!jQuery(this).val()&&jQuery(this).data("allow_empty"))return;let s=parseFloat(jQuery(this).val()||0),i=t(this).attr("min")?parseFloat(t(this).attr("min")):"",a=t(this).attr("max")?parseFloat(t(this).attr("max")):"",d=s;a&&(!s||s>a)?s=a:i&&i>s&&(s=i),s!==d&&t(this).val(s)}),t(".tablenav-pages").find(".current-page").on("focus",function(t){o=!0}).on("blur",function(t){o=!1}),t(".search-box").find('input[type="submit"]').on("click",function(){let e=t(this).closest("form");o||e.find(".current-page").val(1)}),t(".tmds-search-select2:not(.tmds-search-select2-init)").each(function(){let e=t(this),s=!1,i="",a={};if("product"===e.data("type_select2"))s=!0,i="Please enter product title to search",a={action:"tmds_search_products",exclude_tmds_product:1,security:wc_enhanced_select_params.search_products_nonce};e.addClass("tmds-search-select2-init").select2(function(e,s,i,a){let d={width:"100%",closeOnSelect:i,placeholder:e,allowClear:!0,cache:!0};Object.keys(s).length&&(d.minimumInputLength=a,d.escapeMarkup=function(t){return t},d.ajax={url:tmds_params.ajax_url,dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return t.extend(s,{term:e.term})},processResults:function(e){let s=[];return e[0]?s=e:t.each(e,function(t,e){s.push({id:t,text:e?.formatted_name||e?.name||e})}),{results:s}},cache:!0});return d}(i,a,s,2))}),t(document).on("click",".tmds-button-empty-import-list",function(t){if(!confirm("Do you want to delete all products(except overriding products) from your Import list?"))return t.preventDefault(),!1}),t(document).on("change",".tmds-override-woo-id",function(){let e=t(this).closest(".tmds-product-row").find(".tmds-button-import"),s=t(this).val();e.data("override_product_id",""),s?(e.removeClass("tmds-button-import").addClass("tmds-button-map-existing tmds-button-override"),e.html(e.data("override_title"))):(e.addClass("tmds-button-import").removeClass("tmds-button-map-existing tmds-button-override"),e.html(e.data("import_title")))}),t(document).on("click",".tmds-button-override",function(i){i.stopPropagation();let a=t(this),d=a.data("product_id"),o=a.closest(".tmds-accordion.tmds-product-row"),r={};if(o.find(".tmds-variation-enable").length>0){let e=[],s=0;o.find(".tmds-variation-enable").map(function(){let i=t(this).closest(".tmds-product-variation-row");t(this).prop("checked")&&!i.hasClass("tmds-variation-filter-inactive")&&e.push(s),s++}),r[d]=e}else r[d]=[0];if(0===r[d].length)return t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_empty_variation_error,["error"],"",!1,4500]),!1;let n=!1,c=!1;o.find(".tmds-import-data-variation-sale-price").removeClass("tmds-price-error"),o.find(".tmds-import-data-variation-regular-price").removeClass("tmds-price-error");for(let t=0;t<o.find(".tmds-import-data-variation-sale-price").length;t++){let e=o.find(".tmds-import-data-variation-sale-price").eq(t),s=o.find(".tmds-import-data-variation-regular-price").eq(t);parseFloat(s.val())?parseFloat(e.val())>parseFloat(s.val())&&(c=!0,e.addClass("tmds-price-error")):(n=!0,s.addClass("tmds-price-error"))}return n?(t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_empty_price_error,["error"],"",!1,4500]),!1):c?(t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_sale_price_error,["error"],"",!1,4500]),!1):(o.find(".tmds-override-product-product-title").length?t(".tmds-override-product-title").html(o.find(".tmds-override-product-product-title").html()):t(".tmds-override-product-title").html(o.find(".tmds-override-woo-id").find(":selected").html()),t(".tmds-override-product-options-button-override").data("product_id",d).data("override_product_id",a.data("override_product_id")),void function(i){let a=t(".tmds-override-product-options-container");i.hasClass("tmds-button-map-existing")?a.addClass("tmds-override-product-options-container-map-existing"):a.removeClass("tmds-override-product-options-container-map-existing");i.hasClass("tmds-button-reimport")?a.addClass("tmds-override-product-options-container-reimport"):a.removeClass("tmds-override-product-options-container-reimport");a.removeClass("tmds-hidden"),t(".tmds-override-product-options-content-body-override-old").addClass("tmds-hidden");let d=t(".tmds-override-product-options-content-body-option");d.length>0?d.removeClass("tmds-hidden"):t(".tmds-override-product-options-button-override").trigger("click");e=[],s=0,h()}(a))}),t(document).on("click",".tmds-override-product-options-button-override",function(){let i=t(this),a=i.data("product_id"),d=t('.tmds-button-override[data-product_id="'+a+'"]'),o=d.closest(".tmds-button-view-and-edit"),n=t("#tmds-product-item-id-"+a),c=n.find(".tmds-product-container"),m=c.find(".vi-ui.tab").not(".tmds-variations-tab").find("input,select,textarea").serializeArray(),u=t("#wp-tmds-product-description-"+a+"-wrap").hasClass("tmce-active")?tinyMCE.get("tmds-product-description-"+a).getContent():t("#tmds-product-description-"+a).val();m.push({name:"tmds_product["+a+"][description]",value:u});let v={};if(c.find(".tmds-variation-enable").length>0){let e=[],s=0;c.find(".tmds-variation-enable").map(function(){let i=t(this).closest(".tmds-product-variation-row");if(t(this).prop("checked")&&!i.hasClass("tmds-variation-filter-inactive")){e.push(s);let t=i.find("input,select,textarea").serializeArray();if(t.length>0)for(let e=0;e<t.length;e++)m.push(t[e])}s++}),v[a]=e}else v[a]=[0];m.push({name:"z_check_max_input_vars",value:1}),m=t.param(m);let f={},h={};l(m,f),s&&t(".tmds-override-order-container").map(function(){h[t(this).data("replace_item_id")]=t(this).find(".tmds-override-with").val()}),d.addClass("loading"),i.addClass("loading");let g={action:"tmds_override",tmds_nonce:tmds_params.nonce,form_data:f,selected:v,check_orders:s||"",replace_items:h,found_items:e,override_product_id:i.data("override_product_id"),override_woo_id:n.find(".tmds-override-woo-id").val()};if(t(".tmds-override-product-options-option-wrap").length){let e={};for(let s=0;s<t(".tmds-override-product-options-option-wrap").length;s++){let i=t(".tmds-override-product-options-option-wrap").eq(s).find("input");i.data("order_option")&&(e[i.data("order_option")]=i.prop("checked")?1:"")}g.update_settings=e}console.log(g),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:g,success:function(i){if(s)"success"===i.status?(r(),o.append(i.button_html),o.find(".tmds-button-remove").remove(),d.remove(),n.find(".content").remove(),n.find(".tmds-accordion-bulk-item-check").remove(),n.find(".tmds-accordion-title-icon").attr("class","icon check green"),p()):t(document.body).trigger("villatheme_show_message",[i.message,["error"],"",!1,4500]);else if("checked"===i.status){t(".tmds-override-product-options-content-body-override-old").removeClass("tmds-hidden").html(i.replace_order_html),s=1,e=i.found_items,g?.update_settings?.overriding_hide?t(".tmds-override-product-options-content-body-option").remove():t(".tmds-override-product-options-content-body-option").addClass("tmds-hidden")}else"success"===i.status?(r(),o.append(i.button_html),o.find(".tmds-button-remove").remove(),d.remove(),n.find(".content").remove(),n.find(".tmds-accordion-bulk-item-check").remove(),n.find(".tmds-accordion-title-icon").attr("class","icon check green"),p()):t(document.body).trigger("villatheme_show_message",[i.message,["error"],"",!1,4500])},error:function(t){console.log(t)},complete:function(){d.removeClass("loading"),i.removeClass("loading")}})}),t(document).on("change",".tmds-override-with-attributes>select",function(e){if(t(".tmds-override-product-options-override-keep-product").prop("checked")||t(".tmds-override-product-options-container").hasClass("tmds-override-product-options-container-reimport")||t(".tmds-override-product-options-container").hasClass("tmds-override-product-options-container-map-existing")){let e=t(this),s=e.val(),i=e.data("prev_value");t(".tmds-override-with-attributes>select").not(t(this)).map(function(){let e=t(this);s&&e.find(`option[value="${s}"]`).prop("disabled",!0),i&&e.find(`option[value="${i}"]`).prop("disabled",!1)}),e.data("prev_value",s)}}),t(document).on("click",".tmds-override-product-options-button-cancel,.tmds-override-product-options-close,.tmds-override-product-overlay",function(){r()});let n=t(".tmds-import-list-count"),c=t(".tmds-imported-list-count");function l(t,e){const s=t=>decodeURIComponent(t.replace(/\+/g,"%20")),i=String(t).replace(/^&/,"").replace(/&$/,"").split("&"),a=i.length;let d,o,r,n,c,l,m,u,p,v,f,h,g;const b="undefined"!=typeof window?window:global;b.$locutus=b.$locutus||{};const _=b.$locutus;for(_.php=_.php||{},e||(e=b),d=0;d<a&&(u=i[d].split("="),p=s(u[0]),v=u.length<2?"":s(u[1]),!(p.includes("__proto__")||p.includes("constructor")||p.includes("prototype")));d++){for(;" "===p.charAt(0);)p=p.slice(1);if(p.indexOf("\0")>-1&&(p=p.slice(0,p.indexOf("\0"))),p&&"["!==p.charAt(0)){for(h=[],f=0,o=0;o<p.length;o++)if("["!==p.charAt(o)||f){if("]"===p.charAt(o)&&f&&(h.length||h.push(p.slice(0,f-1)),h.push(p.substr(f,o-f)),f=0,"["!==p.charAt(o+1)))break}else f=o+1;for(h.length||(h=[p]),o=0;o<h[0].length&&(m=h[0].charAt(o)," "!==m&&"."!==m&&"["!==m||(h[0]=h[0].substr(0,o)+"_"+h[0].substr(o+1)),"["!==m);o++);for(l=e,o=0,g=h.length;o<g;o++){if(p=h[o].replace(/^['"]/,"").replace(/['"]$/,""),c=l,(""===p||" "===p)&&0!==o){for(n in r=-1,l)l.hasOwnProperty(n)&&+n>r&&n.match(/^\d+$/g)&&(r=+n);p=r+1}Object(l[p])!==l[p]&&(l[p]={}),l=l[p]}c[p]=v}}}function m(){t(".tmds-set-price").removeClass("tmds-set-price-editing"),t(".tmds-attributes-attribute-removing").removeClass("tmds-attributes-attribute-removing"),t(".tmds-modal-popup-container").addClass("tmds-hidden"),f()}function u(){t(".tmds-modal-popup-container").removeClass("tmds-hidden"),h()}function p(){let e=t(".tmds-accordion-bulk-item-check"),s=t(".tmds-accordion-bulk-actions-container"),i=!1;e.length>0&&e.map(function(){if(t(this).prop("checked"))return i=!0,!1}),i?s.fadeIn(200):(s.fadeOut(200),t(".tmds-accordion-bulk-actions").dropdown("clear"))}function v(t,e,s){t.find(".tmds-message").html(`<div class="vi-ui message ${e}"><div>${s}</div></div>`)}function f(){let e=parseInt(t("html").css("top"));t("html").removeClass("tmds-noscroll"),window.scrollTo({top:-e,behavior:"instant"})}function h(){if(t(document).height()>t(window).height()){let e=t("html").scrollTop()?t("html").scrollTop():t("body").scrollTop();t("html").addClass("tmds-noscroll").css("top",-e)}}t(document).on("click",".tmds-button-remove",function(e){e.stopPropagation();let s=t(this),i=s.data("product_id"),a=t("#tmds-product-item-id-"+i);s.closest(".tmds-button-view-and-edit").find(".loading").length||!d&&!confirm(tmds_params.i18n_remove_product_confirm)||(a.accordion("close",0).addClass("tmds-accordion-removing"),s.addClass("loading"),a.find(".tmds-message").html(""),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_remove",tmds_nonce:tmds_params.nonce,product_id:i},success:function(e){if("success"===e.status){let e=parseInt(n.html());if(e>0){let t=parseInt(e-1);n.html(t),n.parent().attr("class","update-plugins count-"+t)}a.fadeOut(300),setTimeout(function(){a.remove(),function(){if(!t(".tmds-accordion").length){let t=new URL(document.location.href);t.searchParams.delete("tmds_search_id"),t.searchParams.delete("tmds_search"),t.searchParams.delete("paged"),document.location.href=t.href}}(),p()},300)}else a.accordion("open",0).removeClass("tmds-accordion-removing"),v(a,"negative",e.message?e.message:"Error")},error:function(t){console.log(t),a.accordion("open",0).removeClass("tmds-accordion-removing"),v(a,"negative",t.statusText)},complete:function(){s.removeClass("loading")}}))}),t(document).on("click",".tmds-button-import",function(e){e.stopPropagation();let s={},d=t(this),o=d.closest(".tmds-button-view-and-edit"),r=d.data("product_id"),m=t("#tmds-product-item-id-"+r);if(m.hasClass("tmds-accordion-importing")||m.hasClass("tmds-accordion-removing")||m.hasClass("tmds-accordion-splitting"))return!1;let u=m.find(".tmds-product-container"),f=u.find(".vi-ui.tab").not(".tmds-variations-tab").find("input,select,textarea").serializeArray(),h=t("#wp-tmds-product-description-"+r+"-wrap").hasClass("tmce-active")?tinyMCE.get("tmds-product-description-"+r).getContent():t("#tmds-product-description-"+r).val(),g={};if(u.find(".tmds-variation-enable").length>0){let e=[],s=0;u.find(".tmds-variation-enable").map(function(){let i=t(this).closest(".tmds-product-variation-row");if(t(this).prop("checked")&&!i.hasClass("tmds-variation-filter-inactive")){e.push(s);let t=i.find("input,select,textarea").serializeArray();if(t.length>0)for(let e=0;e<t.length;e++)f.push(t[e])}s++}),g[r]=e}else g[r]=[0];if(f.push({name:"z_check_max_input_vars",value:1}),f=t.param(f),l(f,s),0===g[r].length)return void t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_empty_variation_error,["error"],"",!1,4500]);let b=!1,_=!1;u.find(".tmds-import-data-variation-sale-price").removeClass("tmds-price-error"),u.find(".tmds-import-data-variation-regular-price").removeClass("tmds-price-error");for(let t=0;t<u.find(".tmds-import-data-variation-sale-price").length;t++){let e=u.find(".tmds-import-data-variation-sale-price").eq(t),s=u.find(".tmds-import-data-variation-regular-price").eq(t);parseFloat(s.val())?parseFloat(e.val())>parseFloat(s.val())&&(_=!0,e.addClass("tmds-price-error")):(b=!0,s.addClass("tmds-price-error"))}if(b)t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_empty_price_error,["error"],"",!1,4500]);else if(_)t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_sale_price_error,["error"],"",!1,4500]);else if(d.addClass("loading"),a)i.push(d);else{m.accordion("close",0).addClass("tmds-accordion-importing"),a=!0;let e={},l={};t.each(s,function(t,s){e[t]="object"==typeof s?JSON.stringify(s).toString():s}),t.each(g,function(t,e){l[t]="object"==typeof e?JSON.stringify(e).toString():e}),e["description_"+r]=h,t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_import",tmds_nonce:tmds_params.nonce,form_data:e,selected:l},success:function(e){if("success"===e.status){let s=parseInt(n.html());s>0?(s--,n.html(s),n.parent().attr("class","update-plugins count-"+s)):(n.html(0),n.parent().attr("class","update-plugins count-0"));let i=parseInt(c.html());i++,c.html(i),c.parent().attr("class","update-plugins count-"+i),0===t(".tmds-button-import").length&&t(".tmds-button-import-all").remove(),o.append(e.button_html),o.find(".tmds-button-remove").remove(),d.remove(),m.find(".content").remove(),m.find(".tmds-accordion-title-icon").attr("class","icon check green"),p()}else d.removeClass("loading"),v(m,"negative",e.message?e.message:"Error")},error:function(t){console.log(t),d.removeClass("loading"),v(m,"negative",t.statusText)},complete:function(){a=!1,m.accordion("open",0).removeClass("tmds-accordion-importing"),i.length>0?i.shift().click():t(".tmds-button-import-all").hasClass("loading")&&(tinyMCE.execCommand("mceRepaint"),t(".tmds-button-import-all").removeClass("loading"))}})}}),t(document).on("click",".tmds-button-import-all",function(){let e=t(this);e.hasClass("loading")||confirm(tmds_params.i18n_import_all_confirm)&&(t(".tmds-button-import").not(".loading").map(function(){0===t(this).closest(".tmds-button-view-and-edit").find(".loading").length&&(i.push(t(this)),t(this).addClass("loading"))}),i.length>0?(a||i.shift().click(),e.addClass("loading")):t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_not_found_error,["error"],"",!1,4500]))}),t(".tmds-import-data-categories,.tmds-modal-popup-set-categories-select").dropdown({fullTextSearch:!0,onAdd:function(e,s,i){t(this).find("a.ui.label").map(function(){let e=t(this);e.html(e.html().replace(/&nbsp;/g,""))})}}),t(document).on("click",".tmds-accordion-bulk-item-check",function(t){t.stopPropagation(),p()}),t(document).on("change",".tmds-accordion-bulk-item-check-all",function(e){e.stopPropagation(),t(".tmds-accordion-bulk-item-check").prop("checked",t(this).prop("checked")).trigger("change"),setTimeout(function(){p()},100)}),t(".tmds-accordion-bulk-actions").dropdown({onChange:function(e){let s=t(".tmds-accordion-bulk-item-check:checked");if(!s.length||!e)return!1;switch(e){case"set_status_publish":case"set_status_pending":case"set_status_draft":let i=e.replace("set_status_","");s.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-status");t.length>0&&t.dropdown("set selected",i)}});break;case"set_visibility_visible":case"set_visibility_catalog":case"set_visibility_search":case"set_visibility_hidden":let a=e.replace("set_visibility_","");s.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-catalog-visibility");t.length>0&&t.dropdown("set selected",a)}});break;case"set_tags":case"set_categories":case"set_shipping_class":let o=e.replace("set_","");t(".tmds-modal-popup-container").attr("class",`tmds-modal-popup-container tmds-modal-popup-container-set-${o}`),u();break;case"import":confirm(tmds_params.i18n_bulk_import_product_confirm)&&s.map(function(){let e=t(this);if(e.prop("checked")){e.closest(".tmds-accordion").find(".tmds-button-import:not(.tmds-hidden)").trigger("click")}});break;case"remove":confirm(tmds_params.i18n_bulk_remove_product_confirm)&&(d=!0,s.map(function(){let e=t(this);if(e.prop("checked")){e.closest(".tmds-accordion").find(".tmds-button-remove").trigger("click")}}),d=!1)}t(".tmds-accordion-bulk-actions").dropdown("clear")}}),t(document).on("click",".tmds-overlay,.tmds-modal-popup-close,.tmds-bulk-action-button-cancel",function(){m()}),t("body").on("click",".tmds-set-categories-button-set",function(){let e=t(".tmds-accordion-bulk-item-check"),s=t('select[name="bulk_set_categories"]').val();e.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-categories");t.length>0&&t.dropdown("set exactly",s)}}),m()}).on("click",".tmds-set-categories-button-add",function(){let e=t(".tmds-accordion-bulk-item-check"),s=t('select[name="bulk_set_categories"]').val();s.length>0&&e.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-categories");t.length>0&&t.dropdown("set exactly",[...new Set(s.concat(t.dropdown("get values")))])}}),m()}).on("click",".tmds-set-tags-button-set",function(){let e=t(".tmds-accordion-bulk-item-check"),s=t('select[name="bulk_set_tags"]').val();e.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-tags");t.length>0&&t.dropdown("set exactly",s)}}),m()}).on("click",".tmds-set-tags-button-add",function(){let e=t(".tmds-accordion-bulk-item-check"),s=t('select[name="bulk_set_tags"]').val();s.length>0&&e.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-tags");t.length>0&&t.dropdown("set exactly",[...new Set(s.concat(t.dropdown("get values")))])}}),m()}).on("click",".tmds-modal-popup-set-categories-clear",function(){t(this).parent().find(".tmds-modal-popup-set-categories-select").dropdown("clear")}).on("click",".tmds-modal-popup-set-tags-clear",function(){t(this).parent().find(".tmds-modal-popup-set-tags-select").dropdown("clear")}).on("click",".tmds-set-shipping_class-button-set",function(){let e=t(".tmds-accordion-bulk-item-check"),s=t('select[name="bulk_set_shipping_class"]').val();e.map(function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tmds-accordion").find(".tmds-import-data-shipping-class");t.length>0&&t.dropdown("set exactly",s)}}),m()}),t("body").on("click",".tmds-set-price",function(){let e=t(this);e.addClass("tmds-set-price-editing"),t(".tmds-modal-popup-container").attr("class","tmds-modal-popup-container tmds-modal-popup-container-set-price"),t(".tmds-modal-popup-content-set-price").find(".tmds-modal-popup-header").find("h2").html("Set "+e.data("set_price").replace(/_/g," ")),u()}),t(document).on("change",".tmds-set-price-amount",function(){let e=parseFloat(t(this).val());isNaN(e)&&(e=0),t(this).val(e)}),t(document).on("click",".tmds-set-price-button-set",function(){t(this);let e,s=t(".tmds-set-price-action").val(),i=parseFloat(t(".tmds-set-price-amount").val()),a=t(".tmds-set-price-editing"),d=a.closest("table");if(e="sale_price"===a.data("set_price")?d.find(".tmds-import-data-variation-sale-price"):d.find(".tmds-import-data-variation-regular-price"),e.length>0)switch(s){case"set_new_value":e.map(function(){let e=t(this),s=e.closest(".tmds-product-variation-row");!s.hasClass("tmds-variation-filter-inactive")&&s.find(".tmds-variation-enable").prop("checked")&&e.val(i)});break;case"increase_by_fixed_value":e.map(function(){let e=t(this),s=e.closest(".tmds-product-variation-row"),a=parseFloat(e.val());!s.hasClass("tmds-variation-filter-inactive")&&s.find(".tmds-variation-enable").prop("checked")&&e.val(a+i)});break;case"increase_by_percentage":e.map(function(){let e=t(this),s=e.closest(".tmds-product-variation-row"),a=parseFloat(e.val());!s.hasClass("tmds-variation-filter-inactive")&&s.find(".tmds-variation-enable").prop("checked")&&e.val((1+i/100)*a)})}m()}),t(document).on("click",".tmds-description-tab-menu",function(){t(`.tmds-description-tab[data-tab="${t(this).data("tab")}"]`).find(".switch-tmce").trigger("click")}),t("body").on("click",".tmds-attribute-filter-item",function(e){let s=t(this),i=[],a=s.closest("table"),d=a.find(".tmds-attribute-filter-list"),o=d.eq(0),r=o.data("attribute_slug");s.hasClass("tmds-attribute-filter-item-active")?s.removeClass("tmds-attribute-filter-item-active"):s.addClass("tmds-attribute-filter-item-active");let n=a.find(".tmds-product-variation-row"),c=o.find(".tmds-attribute-filter-item-active"),l=[];if(c.length>0){c.map(function(){i.push(t(this).data("attribute_value"))});for(let t=0;t<n.length;t++){let e=n.eq(t).find('.tmds-import-data-variation-attribute[data-attribute_slug="'+r+'"]');i.indexOf(e.data("attribute_value"))>-1?l[t]=1:l[t]=0}}else for(let t=0;t<n.length;t++)l[t]=1;if(d.length>1)for(let e=1;e<d.length;e++)if(o=d.eq(e),r=o.data("attribute_slug"),c=o.find(".tmds-attribute-filter-item-active"),c.length>0){c.map(function(){i.push(t(this).data("attribute_value"))});for(let t=0;t<n.length;t++){let e=n.eq(t).find('.tmds-import-data-variation-attribute[data-attribute_slug="'+r+'"]');i.indexOf(e.data("attribute_value"))<0&&(l[t]=0)}}let m=0;for(let t=0;t<n.length;t++){let e=n.eq(t);1==l[t]?(e.removeClass("tmds-variation-filter-inactive"),e.find(".tmds-variation-enable").prop("checked")&&m++):e.addClass("tmds-variation-filter-inactive")}s.closest("form").find(".tmds-selected-variation-count").html(m)}),t("body").on("click",".tmds-specification-attribute-remove",function(){confirm("Are you sure to remove this?")&&t(this).closest("tr").remove()}).on("click",".tmds-attributes-attribute-remove",function(){let e=t(this);e.closest(".tmds-attributes-attribute-row").addClass("tmds-attributes-attribute-removing");let s=t(".tmds-modal-popup-container"),i=t(".tmds-modal-popup-select-attribute");i.html(e.closest(".tmds-attributes-attribute-row").find(".tmds-attributes-attribute-values").html()),i.find(".tmds-attributes-attribute-value").addClass("vi-ui").addClass("button").addClass("mini"),s.attr("class","tmds-modal-popup-container tmds-modal-popup-container-remove-attribute"),u(),1===i.find(".tmds-attributes-attribute-value").length&&i.find(".tmds-attributes-attribute-value").eq(0).trigger("click")}).on("click",".tmds-modal-popup-select-attribute .tmds-attributes-attribute-value",function(){let e=t(this),s=t(".tmds-saving-overlay"),i=t(".tmds-attributes-attribute-removing"),a=i.closest(".tmds-accordion"),d=a.find(".tmds-product-tab").data("tab");s.removeClass("tmds-hidden");let o={};l(i.find("input").serialize(),o),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_remove_attribute",tmds_nonce:tmds_params.nonce,attribute_slug:i.find(".tmds-attributes-attribute-slug").data("attribute_slug"),attribute_value:e.data("attribute_value_id")||e.data("attribute_value"),form_data:o,product_index:d.substring(11)},success:function(e){"success"===e.status&&(a.find(".tmds-attributes-attribute-row").length>1?(i.remove(),a.find(".tmds-variations-tab").removeClass("tmds-variations-tab-loaded")):(a.find(".tmds-attributes-tab-menu").remove(),a.find(".tmds-attributes-tab").remove(),a.find(".tmds-variations-tab-menu").remove(),a.find(".tmds-variations-tab").remove(),a.find(".tabular.menu .item").eq(0).addClass("active"),a.find(".tmds-product-tab").addClass("active"))),e.message&&t(document.body).trigger("villatheme_show_message",[e.message,[e.status],"",!1,4500])},error:function(e){console.log(e),t(document.body).trigger("villatheme_show_message",["An error occurs",["error"],"",!1,4500])},complete:function(){s.addClass("tmds-hidden"),t(".tmds-attributes-attribute-editing").removeClass("tmds-attributes-attribute-editing"),t(".tmds-overlay").trigger("click")}})}),t(document).on("tmds-need-save-attribute",function(e,s){s=t(s);let i=0,a=s.find(".tmds-attributes-attribute-value");s.find(".tmds-attributes-attribute-name").map(function(){t(this).val()!=t(this).data("attribute_name")&&i++}),a.map(function(){t(this).val()!=t(this).data("attribute_value")&&i++}),i>0?s.find(".tmds-button-save-attribute").removeClass("tmds-hidden"):s.find(".tmds-button-save-attribute").addClass("tmds-hidden")}),t(document).on("click",".tmds-attributes-button-save",function(){let e=t(this),s=e.closest(".tmds-accordion"),i=e.closest("tr"),a=0,d=i.find(".tmds-attributes-attribute-value"),o=i.find(".tmds-attributes-attribute-slug"),r=s.find(".tmds-product-overlay"),n=i.find(".tmds-attributes-attribute-name");if(!n.val())return void t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_empty_attribute_name,["error"],"",!1,4500]);n.val()!=n.data("attribute_name")&&a++;let c=[];if(d.map(function(){let e=t(this).val();e!=t(this).data("attribute_value")&&a++,e=e.toLowerCase().trim(),e&&-1===c.indexOf(e)&&c.push(e)}),c.length===d.length||e.hasClass("tmds-attributes-button-save-loading"))if(a>0){let a={},d={};l(i.find("input").serialize(),a),t.each(a,function(t,e){d[t]="object"==typeof e?JSON.stringify(e).toString():e}),r.removeClass("tmds-hidden"),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_save_attributes",tmds_nonce:tmds_params.nonce,form_data:d},success:function(e){if("success"===e.status){let a=!1;e.new_slug&&(a=!0,o.html(e.new_slug),n.data("attribute_name",n.val())),!0===e.change_value&&(a=!0,i.find(".tmds-attributes-attribute-value").map(function(){let e=t(this);e.data("attribute_value",e.val())})),a&&s.find(".tmds-variations-tab").removeClass("tmds-variations-tab-loaded")}e?.message&&t(document.body).trigger("villatheme_show_message",[e.message,[e.status],"",!1,4500])},error:function(t){console.log(t)},complete:function(){e.removeClass("loading tmds-attributes-button-save-loading"),i.removeClass("tmds-attributes-attribute-editing"),i.closest(".tmds-product-row").find(".tmds-attributes-button-save-loading").length?i.closest(".tmds-product-row").find(".tmds-attributes-button-save-loading").eq(0).trigger("click"):(r.addClass("tmds-hidden"),s.find(".tmds-button-save-attribute").removeClass("loading").addClass("tmds-hidden"),s.find(".tmds-variations-tab-menu.active").length&&(s.find(".tmds-variations-tab-loaded").removeClass("tmds-variations-tab-loaded"),s.find(".tmds-variations-tab-menu").trigger("click")))}})}else e.removeClass("loading tmds-attributes-button-save-loading"),i.closest(".tmds-product-row").find(".tmds-attributes-button-save-loading").length?i.closest(".tmds-product-row").find(".tmds-attributes-button-save-loading").eq(0).trigger("click"):(r.addClass("tmds-hidden"),s.find(".tmds-button-save-attribute").removeClass("loading").addClass("tmds-hidden"),s.find(".tmds-variations-tab-menu.active").length&&(s.find(".tmds-variations-tab-loaded").removeClass("tmds-variations-tab-loaded"),s.find(".tmds-variations-tab-menu").trigger("click")));else t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_invalid_attribute_values,["error"],"",!1,4500])}).on("click",".tmds-button-save-attribute",function(e){let s=t(this).closest(".tmds-product-row");s.find(".tmds-attributes-button-save:not(.tmds-attributes-button-save-loading)").map(function(){t(this).addClass("tmds-attributes-button-save-loading")}),s.find(".tmds-attributes-button-save-loading").length&&s.find(".tmds-attributes-button-save-loading").eq(0).trigger("click"),t(this).addClass("loading")}).on("change",".tmds-attributes-tab .tmds-attributes-attribute-value, .tmds-attributes-tab .tmds-attributes-attribute-name",function(){t(document).trigger("tmds-need-save-attribute",t(this).closest(".tmds-attributes-tab"))}),t("body").on("click",".tmds-product-image",function(){let e=t(this).find(".tmds-import-data-image").attr("src"),s=t(this).closest("form");if(e){s.find('.tmds-product-gallery-image[data-image_src="'+e+'"]').closest(".tmds-product-gallery-item").find(".tmds-set-product-image").trigger("click")}}),t(document).on("click",".tmds-gallery-tab-menu",function(){let e=t(this).closest(".tmds-accordion"),s=e.find(".tmds-variations-tab"),i=e.find(".tmds-selected-variation-count"),a=e.find(".tmds-product-gallery");i.length>0&&s.hasClass("tmds-variations-tab-loaded")&&(parseInt(i.html())>0?a.addClass("tmds-allow-set-variation-image"):a.removeClass("tmds-allow-set-variation-image"))}),t(document).on("click",".tmds-lazy-load",function(){let e=t(this),s=e.data("tab");if(!e.hasClass("tmds-lazy-load-loaded")){e.addClass("tmds-lazy-load-loaded"),t('.tmds-lazy-load-tab-data[data-tab="'+s+'"]').find("img").map(function(){let e=t(this).data("image_src");e&&t(this).attr("src",e)})}}),t("body").on("click",".tmds-set-product-image",function(e){e.stopPropagation();let s=t(this),i=s.closest("form").find(".tmds-product-image"),a=s.closest(".tmds-product-gallery-item"),d=s.closest(".tmds-product-gallery");if(a.hasClass("tmds-is-product-image"))a.removeClass("tmds-is-product-image"),i.removeClass("tmds-selected-item"),i.find('input[type="hidden"]').val("");else{a.hasClass("tmds-selected-item")||a.trigger("click"),i.hasClass("tmds-selected-item")||i.addClass("tmds-selected-item"),d.find(".tmds-product-gallery-item").removeClass("tmds-is-product-image"),a.addClass("tmds-is-product-image");let e=a.find("img").data("image_src");t(this).closest(".tmds-accordion").find(".tmds-accordion-product-image").attr("src",e),i.find("img").attr("src",e),i.find('input[type="hidden"]').val(e)}}),t(document).on("click",".tmds-set-variation-image",function(e){e.stopPropagation();let s=t(this),i=s.closest(".tmds-accordion").find(".tmds-product-variation-row").not(".tmds-variation-filter-inactive"),a=s.closest(".tmds-product-gallery-item").find(".tmds-product-gallery-image").data("image_src");a&&i.length>0&&(i.map(function(){let e=t(this);if(e.find(".tmds-variation-enable").prop("checked")){let t=e.find(".tmds-variation-image"),s=t.find('input[type="hidden"]');t.find(".tmds-import-data-variation-image").attr("src",a).attr("image_src",a),s.val()&&s.val(a)}}),t(document.body).trigger("villatheme_show_message",["Image is set for selected variations",["success"],"",!1,4500]))}),t(document).on("click",".tmds-button-split",function(){let e=t(this),s=e.closest(".tmds-accordion"),i=s.find(".tmds-product-overlay"),a=e.closest(".tmds-variations-tab"),d=e.closest(".tmds-button-split-container"),o=e.data("product_id"),r=e.data("split_attribute_id"),n=[];if(!(d.find(".loading").length>0)){if(r){if(!confirm(e.data("split_product_message")+` ${tmds_params.i18n_split_product_message}`))return}else{if(a.find(".tmds-product-variation-row").not(".tmds-variation-filter-inactive").map(function(){t(this).find(".tmds-variation-enable").prop("checked")&&n.push(t(this).find(".tmds-import-data-variation-skuId").val())}),0===n.length)return void t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_split_product_no_variations,["error"],"",!1,4500]);if(n.length===a.find(".tmds-product-variation-row").length)return void t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_split_product_too_many_variations,["error"],"",!1,4500]);if(!confirm(`${tmds_params.i18n_split_product_confirm} ${tmds_params.i18n_split_product_message}`))return}e.addClass("loading"),i.removeClass("tmds-hidden"),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_split_product",tmds_nonce:tmds_params.nonce,product_id:o,split_attribute_id:r,split_variations_ids:n},success:function(e){"success"===e.status?(e?.message&&t(document.body).trigger("villatheme_show_message",[e.message,["success"],"",!1,4500]),document.location.reload()):v(s,"negative",e.message)},error:function(t){console.log(t),v(s,"negative",t.statusText)},complete:function(){e.removeClass("loading"),i.addClass("tmds-hidden")}})}}),t("body").on("click",".tmds-product-gallery-item",function(){let e=t(this),s=e.find(".tmds-product-gallery-image"),i=e.closest("form"),a=i.find(".tmds-product-gallery"),d=i.find(".tmds-product-image");e.hasClass("tmds-selected-item")?(e.hasClass("tmds-is-product-image")&&(e.removeClass("tmds-is-product-image"),e.find("tmds-set-product-image").trigger("click"),d.removeClass("tmds-selected-item").find('input[type="hidden"]').val("")),e.removeClass("tmds-selected-item").find('input[type="hidden"]').val("")):e.addClass("tmds-selected-item").find('input[type="hidden"]').val(s.data("image_src")),i.find(".tmds-selected-gallery-count").html(a.find(".tmds-selected-item").length)}),t(document).on("click",".tmds-reviews-tab-menu",function(){let e=t(this),s=e.closest(".tmds-accordion").find(".tmds-product-overlay"),i=e.data("tab"),a=t('.tmds-reviews-tab[data-tab="'+i+'"]');a.hasClass("tmds-reviews-tab-loaded")||(s.removeClass("tmds-hidden"),t.ajax({url:tmds_params.ajax_url,type:"GET",dataType:"JSON",data:{action:"tmds_load_product_reviews",tmds_nonce:tmds_params.nonce,product_id:a.data("product_id"),product_index:i.substring(8)},success:function(s){let i;"success"===s.status?(a.addClass("tmds-reviews-tab-loaded"),i=s.data,s?.reviews_count&&e.closest(".tmds-product-container").find(".tmds-selected-review-count").html(parseInt(s.reviews_count))):i=`<div class="vi-ui negative message">${s.message}</div>`,a.html(i),t(document).trigger("tmds_after_load_product_reviews",[s,a])},error:function(t){console.log(t),a.html('<div class="vi-ui negative message">ERROR</div>')},complete:function(){s.addClass("tmds-hidden")}}))}),t(document).on("click",".tmds-variations-tab-menu",function(){let e=t(this),s=e.closest(".tmds-accordion").find(".tmds-product-overlay"),i=e.data("tab"),a=t('.tmds-variations-tab[data-tab="'+i+'"]'),d=a.find(".tmds-variations-table");a.hasClass("tmds-variations-tab-loaded")||(s.removeClass("tmds-hidden"),t.ajax({url:tmds_params.ajax_url,type:"GET",dataType:"JSON",data:{action:"tmds_load_variations_table",tmds_nonce:tmds_params.nonce,product_id:a.data("product_id"),product_index:i.substring(11)},success:function(s){let i;"success"===s.status?(a.addClass("tmds-variations-tab-loaded"),i=s.data,s?.split_option&&a.find(".tmds-button-split-container").html(s.split_option),s?.variations_count&&e.closest(".tmds-product-container").find(".tmds-selected-variation-count").html(parseInt(s.variations_count))):i=`<div class="vi-ui negative message">${s.message}</div>`,d.html(i).find(".vi-ui.dropdown").dropdown({fullTextSearch:!0,forceSelection:!1,selectOnKeydown:!1});let o=d.find("tbody");o.find(".tmds-product-variation-row").map(function(){let e=t(this);e.find(".tmds-variation-enable").prop("checked")||o.append(e)});let r=1;o.find(".tmds-product-variation-row-number").map(function(){t(this).html(r++)}),t(document).trigger("tmds_after_load_variations_table",[s,d])},error:function(t){console.log(t),d.html('<div class="vi-ui negative message">ERROR</div>')},complete:function(){s.addClass("tmds-hidden")}}))}),t("body").on("click",".tmds-import-data-variation-default",function(){let e=t(this);if(e.prop("checked")){let t=e.closest("tr").find(".tmds-variation-enable");t.prop("checked")||t.trigger("click")}}),function(){let e;t("body").on("click",".tmds-variations-bulk-enable",function(){let e=t(this).closest("form"),s=0;t(this).prop("checked")?(s=e.find(".tmds-product-variation-row").length-e.find(".tmds-variation-filter-inactive").length,e.find(".tmds-variations-bulk-select-image").prop("checked",!0).trigger("change")):(e.find(".tmds-import-data-variation-default").prop("checked",!1),e.find(".tmds-variations-bulk-select-image").prop("checked",!1).trigger("change")),e.find(".tmds-product-variation-row:not(.tmds-variation-filter-inactive) .tmds-variation-enable").prop("checked",t(this).prop("checked")),e.find(".tmds-selected-variation-count").html(s)}).on("click",".tmds-variation-enable",function(s){let i=t(this),a=i.closest("form"),d=a.find(".tmds-variation-enable").index(e),o=0;if(s.shiftKey){let t=a.find(".tmds-variation-enable").index(i);if(i.prop("checked"))if(d<t)for(let e=d;e<=t;e++)a.find(".tmds-variation-enable").eq(e).prop("checked",!0);else for(let e=t;e<=d;e++)a.find(".tmds-variation-enable").eq(e).prop("checked",!0);else if(d<t)for(let e=d;e<=t;e++)a.find(".tmds-variation-enable").eq(e).prop("checked",!1);else for(let e=t;e<=d;e++)a.find(".tmds-variation-enable").eq(e).prop("checked",!1)}a.find(".tmds-variation-enable").map(function(){let e=t(this).closest("tr");t(this).prop("checked")&&!e.hasClass("tmds-variation-filter-inactive")?(o++,e.find(".tmds-variation-image").removeClass("tmds-selected-item").trigger("click")):(e.find(".tmds-variation-image").addClass("tmds-selected-item").trigger("click"),e.find(".tmds-import-data-variation-default").prop("checked",!1))}),a.find(".tmds-selected-variation-count").html(o),e=t(this)})}(),t("body").on("click",".tmds-variation-image",function(){let e=t(this);e.hasClass("tmds-selected-item")?e.removeClass("tmds-selected-item").find('input[type="hidden"]').val(""):(e.addClass("tmds-selected-item").find('input[type="hidden"]').val(e.find("img").attr("src")),e.closest("tr").find(".tmds-variation-enable").prop("checked",!0).trigger("change"))}),t("body").on("change",".tmds-variations-bulk-select-image",function(){let e=t(this),s=e.closest("form");setTimeout(function(s){s.removeClass("tmds-selected-item"),s.map(function(){let s=t(this);e.prop("checked")&&s.closest(".tmds-product-variation-row").find(".tmds-variation-enable").prop("checked")?(s.addClass("tmds-selected-item"),s.find('input[type="hidden"]').val(s.find(".tmds-import-data-variation-image").attr("src"))):s.find('input[type="hidden"]').val("")})},100,s.find(".tmds-variation-image"))}),t(document).on("keydown",function(e){t(".tmds-set-price-container").hasClass("tmds-hidden")?t(".tmds-override-product-options-container").hasClass("tmds-hidden")||(13==e.keyCode?t(".tmds-override-product-options-button-override").trigger("click"):27==e.keyCode&&t(".tmds-override-product-overlay").trigger("click")):13==e.keyCode?t(".tmds-set-price-button-set").trigger("click"):27==e.keyCode&&t(".tmds-overlay").trigger("click")})});