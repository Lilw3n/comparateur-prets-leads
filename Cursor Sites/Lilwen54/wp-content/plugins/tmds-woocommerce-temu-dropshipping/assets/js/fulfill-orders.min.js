jQuery(document).ready(function(t){"use strict";let d=!1;t(document).on("focus",".tmds-pagination-form .tablenav-pages .current-page",function(t){d=!0}),t(document).on("blur",".tmds-pagination-form .tablenav-pages .current-page",function(t){d=!1}),t(document).on("click",'.tmds-pagination-form .search-box input[type="submit"]',function(e){let i=t(this).closest("form");d||i.find(".current-page").val(1)}),t(document).on("click",".tmds-order-id",function(d){let e=t(this).attr("href");if(!e||["#"].includes(e))return!1}),t(document).on("click",".tmds-item-actions-edit",function(){let d=t(this);d.addClass("tmds-hidden");let e=d.closest(".tmds-order-item");e.addClass("tmds-order-id-editing");let i=e.find(".tmds-order-id");i.data("o_href",i.attr("href")).attr("href",""),i.find(".tmds-order-id-input").prop("readonly",!1).focus(),e.find(".tmds-item-actions-save").removeClass("tmds-hidden"),e.find(".tmds-item-actions-cancel").removeClass("tmds-hidden")}),t(document).on("click",".tmds-item-actions-cancel",function(){let d=t(this);d.addClass("tmds-hidden");let e=d.closest(".tmds-order-item");e.removeClass("tmds-order-id-editing");let i=e.find(".tmds-order-id");i.attr("href",i.data("o_href")),i.find(".tmds-order-id-input").prop("readonly",!0).focus(),e.find(".tmds-item-actions-save").addClass("tmds-hidden"),e.find(".tmds-item-actions-edit").removeClass("tmds-hidden")}),t(document).on("click",".tmds-item-actions-save",function(){let d=t(this),e=d.closest(".tmds-order-container").find(".tmds-order-overlay"),i=d.closest(".tmds-order-item"),s=i.data("order_item_id"),a=i.find(".tmds-order-id"),r=a.find(".tmds-order-id-input"),o=r.val(),n=a.data("old_fulfill_order_id");o==n?i.find(".tmds-item-actions-cancel").trigger("click"):(e.removeClass("tmds-hidden"),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_manually_update_fulfill_order_id",tmds_nonce:tmds_params.nonce,item_id:s,fulfill_order_id:o},success:function(t){"success"===t.status?(d.addClass("tmds-hidden"),r.prop("readonly",!0),o?i.find(".tmds-order-item-check").prop("disabled",!0):i.find(".tmds-order-item-check").prop("disabled",!1),i.find(".tmds-item-actions-edit").removeClass("tmds-hidden"),i.find(".tmds-item-actions-cancel").addClass("tmds-hidden"),e.addClass("tmds-hidden"),a.data("old_fulfill_order_id",o).attr("href",t.fulfill_order_detail_url||""),i.removeClass("tmds-order-id-editing")):alert(t.message),e.addClass("tmds-hidden")},error:function(t){console.log(t),e.addClass("tmds-hidden")}}))}),t(document).on("click",".tmds-order-check-all",function(){t(this).closest(".tmds-order-container").find(".tmds-order-item-check").trigger("click")}),t(document).on("click",".tmds-order-with-extension",function(){let d=t(this).closest(".tmds-order-container"),e=d.find(".tmds-order-item-check:checked"),i=e.length;if(!i)return void t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_empty_item_id,["error"],"",!1,4500]);let s={action:"add_to_cart",order_id:d.data("order_id")},a="",r={},o=!1;for(let d=0;d<i;d++){let i=t(e[d]).closest(".tmds-order-item"),s=i.data("fulfill_region");if(a){if(s&&s!=a){o=!0;break}}else a=s;r[i.data("order_item_id")]={fulfill_product_id:i.data("fulfill_product_id"),fulfill_variation_id:i.data("fulfill_variation_id"),quantity:i.data("quantity")}}if(o)return void t(document.body).trigger("villatheme_show_message",[tmds_params.i18n_multi_region,["error"],"",!1,4500]);s.fulfill_region=a;let n=new URL(tmds_params.fulfill_url);t.each(s,function(t,d){n.searchParams.set("tmds_"+t,d)});let l={...s,order_items:r,domain:n.searchParams.get("tmds_from_domain"),fulfill_url:n.href};postMessage({action:"tmds_fulfill",fulfill_params:l})}),window.addEventListener("message",d=>{if("tmds_fulfill_message"===d.data?.action){let e=d.data?.domain;(location.origin+location.pathname).includes(e)&&d.data?.message&&d.data?.message_type&&t(document.body).trigger("villatheme_show_message",[d.data.message,[d.data.message_type],"",!1,4500])}})});