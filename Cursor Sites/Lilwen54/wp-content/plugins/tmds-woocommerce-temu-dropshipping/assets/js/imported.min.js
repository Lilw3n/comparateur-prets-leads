jQuery(document).ready(function(t){"use strict";let e=!1;t(".tablenav-pages").find(".current-page").on("focus",()=>e=!0).on("blur",()=>e=!1),t(".search-box").find('input[type="submit"]').on("click",function(){let d=t(this).closest("form");e||d.find(".current-page").val(1)}),t(".vi-ui.tabular.menu .item").tab(),t(".vi-ui.accordion").accordion("refresh"),t("select.vi-ui.dropdown").dropdown(),t(".tmds-accordion-store-url").on("click",t=>t.stopPropagation());let d,o,s=[],r=!1,i=t(".tmds-imported-list-count");function a(){t(".tmds-delete-product-options-content-header-delete").addClass("tmds-hidden"),t(".tmds-delete-product-options-button-delete").addClass("tmds-hidden").data("product_id","").data("woo_product_id",""),t(".tmds-delete-product-options-delete-woo-product-wrap").addClass("tmds-hidden"),t(".tmds-delete-product-options").addClass("tmds-delete-product-options-editing"),t(".tmds-delete-product-options-container").addClass("tmds-hidden"),function(){let e=parseInt(t("html").css("top"));t("html").removeClass("tmds-noscroll"),window.scrollTo({top:-e,behavior:"instant"})}(),t(".tmds-delete-product-options-content-header-override").addClass("tmds-hidden"),t(".tmds-delete-product-options-button-override").addClass("tmds-hidden").data("product_id","").data("woo_product_id",""),t(".tmds-delete-product-options-override-product-wrap").addClass("tmds-hidden")}function c(){t(".tmds-delete-product-options-container").removeClass("tmds-hidden"),function(){if(t(document).height()>t(window).height()){let e=t("html").scrollTop()?t("html").scrollTop():t("body").scrollTop();t("html").addClass("tmds-noscroll").css("top",-e)}}()}function n(e,d,o){let a=t(`.tmds-button-delete[data-product_id="${e}"]`),c=t(`#tmds-product-item-id-${e}`);c.find(".tmds-message").html(""),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_delete_product",tmds_nonce:tmds_params.nonce,product_id:e,woo_product_id:d,delete_woo_product:o},success:function(e){if("success"===e.status){let e=parseInt(i.html());if(e>0){let t=parseInt(e-1);i.html(t),i.parent().attr("class","update-plugins count-"+t)}c.fadeOut(300),setTimeout(function(){c.remove(),function(){if(0===t(".tmds-accordion").length){let t=new URL(document.location.href);t.searchParams.delete("tmds_search_woo_id"),t.searchParams.delete("tmds_search_id"),t.searchParams.delete("tmds_search"),t.searchParams.delete("paged"),document.location.href=t.href}}()},300)}else m(c,"negative",e.message),c.removeClass("tmds-accordion-deleting").accordion("open",0)},error:function(t){m(c,"negative",t.statusText),c.removeClass("tmds-accordion-deleting").accordion("open",0)},complete:function(){if(r=!1,a.removeClass("loading"),s.length>0){let t=s.shift();n(t.product_id,t.woo_product_id,t.delete_woo_product)}}})}function m(t,e,d){t.find(".tmds-message").html(`<div class="vi-ui message ${e}"><div>${d}</div></div>`)}t(document).on("click",".tmds-product-notice-dismiss",function(){let e=t(this);e.closest(".vi-ui.message").fadeOut(200),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_dismiss_product_notice",tmds_nonce:tmds_params.nonce,product_id:e.data("product_id")},success:function(t){},error:function(t){console.log(t)},complete:function(){}})}),window.addEventListener("message",e=>{switch(e.data.action){case"close_tab_import":case"tmds_import_error":case"tmds_import_completed":let{tmds_action:d,tmds_url_values:o,popup_name:s,pid:r}=e.data;if(!["override","sync"].includes(d))break;if(!o||!o?.tmds_from_domain||o.tmds_from_domain!=tmds_params.site_url)break;if(!s&&!r)break;let i=".tmds-waiting-"+d+"-from-extension";t(i).removeClass(i+" loading"),e.data?.message&&t(document.body).trigger("villatheme_show_message",[e.data.message,[e.data?.message_type],e.data?.message_content,e.data?.message_timeout||0]),"success"===e.data?.message_type&&"override"===d&&(location.href=tmds_params.import_list_url)}}),t(document).on("click",".tmds-button-update-product",function(e){e.stopPropagation(),e.preventDefault();let d=t(this),o=d.data(),s=d.data("sync_url"),r=new URL(s);t.each(o,function(t,e){e&&"sync_url"!==t&&r.searchParams.set("tmds_"+t,e)}),d.addClass("tmds-waiting-sync-from-extension loading"),window.open(r.href,"tmds_sync_"+o.product_id,"width=760,height=760")}),t(document).on("click",".tmds-button-override",function(){let e=t(this),d=e.data("product_id"),o=e.data("product_title"),s=e.data("woo_product_id");t(".tmds-delete-product-options-product-title").html(o),t(".tmds-delete-product-options-button-override").data("product_id",d).data("woo_product_id",s),t(".tmds-delete-product-options-override-product-message").addClass("tmds-hidden"),t(".tmds-delete-product-options-content-header-override").removeClass("tmds-hidden"),t(".tmds-delete-product-options-button-override").removeClass("tmds-hidden tmds-checked").html(tmds_params.check),t(".tmds-delete-product-options-override-product-wrap").removeClass("tmds-hidden"),t(".tmds-delete-product-options-override-product-new-image").find("img").attr("src",""),t(".tmds-delete-product-options-override-product-new-title").html(""),t(".tmds-delete-product-options-override-product-new-wrap").addClass("tmds-hidden"),c(),t(".tmds-delete-product-options-override-product").val("").focus()}),t(document).on("click",".tmds-delete-product-options-button-override",function(){let e=t(this),s=t("#tmds-delete-product-options-override-product").val(),r=e.data("product_id"),i=e.data("woo_product_id"),c=t('.tmds-button-override[data-product_id="'+r+'"]'),n="check";if(e.hasClass("tmds-checked")&&(n="override"),"check"===n){if(!t(".tmds-delete-product-options-override-product-new-wrap").hasClass("tmds-hidden"))return void t(".tmds-delete-product-options-override-product-new-close").trigger("click");if(!s)return t(document.body).trigger("villatheme_show_message",["Please enter url or ID of product you want to use to override current product with",["error"],"",!1,4500]),void t("#tmds-delete-product-options-override-product").trigger("focus")}else if(!d&&!o)return t(document.body).trigger("villatheme_show_message",["Please enter product url or id to check.",["error"],"",!1,4500]),void t("#tmds-delete-product-options-override-product").trigger("focus");t(".tmds-delete-product-options-override-product-message").addClass("tmds-hidden"),c.addClass("loading"),e.addClass("loading"),t.ajax({url:tmds_params.ajax_url,type:"POST",dataType:"JSON",data:{action:"tmds_override_product",tmds_nonce:tmds_params.nonce,product_id:r,woo_product_id:i,override_product_url:s,override_product_data:d,override_product_id:o,step:n,replace_description:t(".tmds-delete-product-options-override-product-replace-description").prop("checked")?1:0},success:function(s){if("check"===n)if("error"===s.status)t(".tmds-delete-product-options-override-product-message").removeClass("tmds-hidden").html(s.message);else{if(s?.redirect_url){let e=new URL(s.redirect_url);s?.redirect_param&&t.each(s.redirect_param,function(t,d){e.searchParams.set(t,d)}),window.open(e.href,"tmds_overriding_"+r,"width=760,height=760")}else d=s.data,o=s.exist_product_id,t(".tmds-delete-product-options-override-product-new-wrap").removeClass("tmds-hidden"),t(".tmds-delete-product-options-override-product-new-image").find("img").attr("src",s.image),t(".tmds-delete-product-options-override-product-new-title").html(s.title),"success"===s.status&&e.html(tmds_params.override).addClass("tmds-checked");s.message&&t(".tmds-delete-product-options-override-product-message").removeClass("tmds-hidden").html(s.message)}else if("success"===s.status){let e=t("#tmds-product-item-id-"+r);e.find("div.content").eq(0).prepend(s.data),c.remove(),e.find(".tmds-button-reimport").remove(),e.find(".tmds-button-override-container").append(s.button_override_html),a()}else e.html(tmds_params.check).removeClass("tmds-checked"),s.message&&t(".tmds-delete-product-options-override-product-message").removeClass("tmds-hidden").html(s.message)},error:function(t){console.log(t)},complete:function(){c.removeClass("loading"),e.removeClass("loading")}})}),t(".tmds-button-restore").on("click",function(){let e=t(this),d=t(".tmds-imported-products-count-trash"),o=parseInt(d.html()),s=t(".tmds-imported-products-count-publish"),r=parseInt(s.html()),a={action:"tmds_restore_product",tmds_nonce:tmds_params.nonce,product_id:t(this).data("product_id")},c=t("#tmds-product-item-id-"+a.product_id);e.addClass("loading"),t.ajax({url:tmds_params.ajax_url,type:"post",dataType:"JSON",data:a,success:function(t){if("success"===t.status){let t=parseInt(i.html());if(t>0){let e=t+1;i.html(e),i.parent().attr("class","update-plugins count-"+e)}o--,r++,c.fadeOut(300),setTimeout(function(){d.html(o),s.html(r),c.remove()},300)}t.message&&jQuery(document.body).trigger("villatheme_show_message",[t.message,[t.status],"",!1,4500])},error:function(t){console.log(t)},complete:function(){e.removeClass("loading")}})}),t(".tmds-button-trash").on("click",function(){let e=t(this),d=t(".tmds-imported-products-count-trash"),o=parseInt(d.html()),s=t(".tmds-imported-products-count-publish"),r=parseInt(s.html()),a={action:"tmds_trash_product",tmds_nonce:tmds_params.nonce,product_id:t(this).data("product_id")},c=t("#tmds-product-item-id-"+a.product_id);e.addClass("loading"),t.ajax({url:tmds_params.ajax_url,type:"post",dataType:"JSON",data:a,success:function(t){if("success"===t.status){let t=parseInt(i.html());if(t>0){let e=t-1;i.html(e),i.parent().attr("class","update-plugins count-"+e)}o++,r--,c.fadeOut(300),setTimeout(function(){d.html(o),s.html(r),c.remove()},300)}t.message&&jQuery(document.body).trigger("villatheme_show_message",[t.message,[t.status],"",!1,4500])},error:function(t){console.log(t)},complete:function(){e.removeClass("loading")}})}),t(document).on("click",".tmds-delete-product-options-button-delete",function(){let e=t(this),d=e.data().product_id,o=e.data().woo_product_id;t(`.tmds-button-delete[data-product_id="${d}"]`).addClass("loading"),t(`#tmds-product-item-id-${d}`).addClass("tmds-accordion-deleting").accordion("close",0);let i=t(".tmds-delete-product-options-delete-woo-product").prop("checked")?1:0;a(),r?s.push({product_id:d,woo_product_id:o,delete_woo_product:i}):(r=!0,n(d,o,i))}),t(document).on("click",".tmds-button-delete",function(){let e=t(this);if(!e.hasClass("loading")){let d=e.data().product_title,o=e.data().product_id,s=e.data().woo_product_id;t(".tmds-delete-product-options-product-title").html(d),t(".tmds-delete-product-options-button-delete").data("product_id",o).data("woo_product_id",s),t(".tmds-delete-product-options-content-header-delete").removeClass("tmds-hidden"),t(".tmds-delete-product-options-button-delete").removeClass("tmds-hidden"),t(".tmds-delete-product-options-delete-woo-product-wrap").removeClass("tmds-hidden"),c()}}),t(document).on("click",".tmds-overlay,.tmds-delete-product-options-close,.tmds-delete-product-options-button-cancel",()=>a()),t(document).on("keydown",function(e){t(".tmds-delete-product-options-container").hasClass("tmds-hidden")||(13==e.keyCode?t(".tmds-delete-product-options-button-override").hasClass("tmds-hidden")?t(".tmds-delete-product-options-button-delete").hasClass("tmds-hidden")||t(".tmds-delete-product-options-button-delete").trigger("click"):(t(".tmds-delete-product-options-button-override").trigger("click"),t(".tmds-delete-product-options-override-product").focus()):27===e.keyCode&&t(".tmds-overlay").trigger("click"))})});